parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"JPYe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;const t=2.3283064365386963e-10;class e{constructor(){this._seed=0,this._s0=0,this._s1=0,this._s2=0,this._c=0}getSeed(){return this._seed}setSeed(e){return e=e<1?1/e:e,this._seed=e,this._s0=(e>>>0)*t,e=69069*e+1>>>0,this._s1=e*t,e=69069*e+1>>>0,this._s2=e*t,this._c=1,this}getUniform(){let e=2091639*this._s0+this._c*t;return this._s0=this._s1,this._s1=this._s2,this._c=0|e,this._s2=e-this._c,this._s2}getUniformInt(t,e){let s=Math.max(t,e),i=Math.min(t,e);return Math.floor(this.getUniform()*(s-i+1))+i}getNormal(t=0,e=1){let s,i,h;do{h=(s=2*this.getUniform()-1)*s+(i=2*this.getUniform()-1)*i}while(h>1||0==h);return t+s*Math.sqrt(-2*Math.log(h)/h)*e}getPercentage(){return 1+Math.floor(100*this.getUniform())}getItem(t){return t.length?t[Math.floor(this.getUniform()*t.length)]:null}shuffle(t){let e=[],s=t.slice();for(;s.length;){let t=s.indexOf(this.getItem(s));e.push(s.splice(t,1)[0])}return e}getWeightedValue(t){let e=0;for(let r in t)e+=t[r];let s,i=this.getUniform()*e,h=0;for(s in t)if(i<(h+=t[s]))return s;return s}getState(){return[this._s0,this._s1,this._s2,this._c]}setState(t){return this._s0=t[0],this._s1=t[1],this._s2=t[2],this._c=t[3],this}clone(){return(new e).setState(this.getState())}}var s=(new e).setSeed(Date.now());exports.default=s;
},{}],"R5vl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e{getContainer(){return null}setOptions(e){this._options=e}}exports.default=e;
},{}],"dVhx":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./backend.js"));function e(t){return t&&t.__esModule?t:{default:t}}class i extends t.default{constructor(){super(),this._ctx=document.createElement("canvas").getContext("2d")}schedule(t){requestAnimationFrame(t)}getContainer(){return this._ctx.canvas}setOptions(t){super.setOptions(t);const e=`${t.fontStyle?`${t.fontStyle} `:""} ${t.fontSize}px ${t.fontFamily}`;this._ctx.font=e,this._updateSize(),this._ctx.font=e,this._ctx.textAlign="center",this._ctx.textBaseline="middle"}clear(){this._ctx.fillStyle=this._options.bg,this._ctx.fillRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height)}eventToPosition(t,e){let i=this._ctx.canvas,s=i.getBoundingClientRect();return t-=s.left,e-=s.top,t*=i.width/s.width,e*=i.height/s.height,t<0||e<0||t>=i.width||e>=i.height?[-1,-1]:this._normalizedEventToPosition(t,e)}}exports.default=i;
},{"./backend.js":"R5vl"}],"gHLf":[function(require,module,exports) {
"use strict";function t(t,r){return(t%r+r)%r}function r(t,r=0,e=1){return t<r?r:t>e?e:t}function e(t){return t.charAt(0).toUpperCase()+t.substring(1)}function n(t,...r){let o=n.map;return t.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi,function(n,i,s,u){if("%"==t.charAt(u-1))return n.substring(1);if(!r.length)return n;let a=r[0],p=(i||s).split(","),c=p.shift()||"",f=o[c.toLowerCase()];if(!f)return n;let l=(a=r.shift())[f].apply(a,p),h=c.charAt(0);return h!=h.toLowerCase()&&(l=e(l)),l})}Object.defineProperty(exports,"__esModule",{value:!0}),exports.mod=t,exports.clamp=r,exports.capitalize=e,exports.format=n,n.map={s:"toString"};
},{}],"NVkk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("./canvas.js")),i=require("../util.js");function s(t){return t&&t.__esModule?t:{default:t}}class e extends t.default{constructor(){super(),this._spacingX=0,this._spacingY=0,this._hexSize=0}draw(t,i){let[s,e,h,o,n]=t,a=[(s+1)*this._spacingX,e*this._spacingY+this._hexSize];if(this._options.transpose&&a.reverse(),i&&(this._ctx.fillStyle=n,this._fill(a[0],a[1])),!h)return;this._ctx.fillStyle=o;let _=[].concat(h);for(let l=0;l<_.length;l++)this._ctx.fillText(_[l],a[0],Math.ceil(a[1]))}computeSize(t,i){return this._options.transpose&&(t+=i,t-=i=t-i),[Math.floor(t/this._spacingX)-1,Math.floor((i-2*this._hexSize)/this._spacingY+1)]}computeFontSize(t,i){this._options.transpose&&(t+=i,t-=i=t-i);let s=2*t/((this._options.width+1)*Math.sqrt(3))-1,e=i/(2+1.5*(this._options.height-1)),h=Math.min(s,e),o=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let n=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=o;let a=n/100,_=2*(h=Math.floor(h)+1)/(this._options.spacing*(1+a/Math.sqrt(3)));return Math.ceil(_)-1}_normalizedEventToPosition(t,s){let e;this._options.transpose?(t+=s,t-=s=t-s,e=this._ctx.canvas.width):e=this._ctx.canvas.height;let h=e/this._options.height;return s=Math.floor(s/h),(0,i.mod)(s,2)?(t-=this._spacingX,t=1+2*Math.floor(t/(2*this._spacingX))):t=2*Math.floor(t/(2*this._spacingX)),[t,s]}_fill(t,i){let s=this._hexSize,e=this._options.border;const h=this._ctx;h.beginPath(),this._options.transpose?(h.moveTo(t-s+e,i),h.lineTo(t-s/2+e,i+this._spacingX-e),h.lineTo(t+s/2-e,i+this._spacingX-e),h.lineTo(t+s-e,i),h.lineTo(t+s/2-e,i-this._spacingX+e),h.lineTo(t-s/2+e,i-this._spacingX+e),h.lineTo(t-s+e,i)):(h.moveTo(t,i-s+e),h.lineTo(t+this._spacingX-e,i-s/2+e),h.lineTo(t+this._spacingX-e,i+s/2-e),h.lineTo(t,i+s-e),h.lineTo(t-this._spacingX+e,i+s/2-e),h.lineTo(t-this._spacingX+e,i-s/2+e),h.lineTo(t,i-s+e)),h.fill()}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);let s,e;this._hexSize=Math.floor(t.spacing*(t.fontSize+i/Math.sqrt(3))/2),this._spacingX=this._hexSize*Math.sqrt(3)/2,this._spacingY=1.5*this._hexSize,t.transpose?(s="height",e="width"):(s="width",e="height"),this._ctx.canvas[s]=Math.ceil((t.width+1)*this._spacingX),this._ctx.canvas[e]=Math.ceil((t.height-1)*this._spacingY+2*this._hexSize)}}exports.default=e;
},{"./canvas.js":"dVhx","../util.js":"gHLf"}],"s7HM":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("./canvas.js"));function i(t){return t&&t.__esModule?t:{default:t}}let s=(()=>{class i extends t.default{constructor(){super(),this._spacingX=0,this._spacingY=0,this._canvasCache={}}setOptions(t){super.setOptions(t),this._canvasCache={}}draw(t,s){i.cache?this._drawWithCache(t):this._drawNoCache(t,s)}_drawWithCache(t){let i,[s,e,a,h,c]=t,n=""+a+h+c;if(n in this._canvasCache)i=this._canvasCache[n];else{let t=this._options.border,s=(i=document.createElement("canvas")).getContext("2d");if(i.width=this._spacingX,i.height=this._spacingY,s.fillStyle=c,s.fillRect(t,t,i.width-t,i.height-t),a){s.fillStyle=h,s.font=this._ctx.font,s.textAlign="center",s.textBaseline="middle";let t=[].concat(a);for(let i=0;i<t.length;i++)s.fillText(t[i],this._spacingX/2,Math.ceil(this._spacingY/2))}this._canvasCache[n]=i}this._ctx.drawImage(i,s*this._spacingX,e*this._spacingY)}_drawNoCache(t,i){let[s,e,a,h,c]=t;if(i){let t=this._options.border;this._ctx.fillStyle=c,this._ctx.fillRect(s*this._spacingX+t,e*this._spacingY+t,this._spacingX-t,this._spacingY-t)}if(!a)return;this._ctx.fillStyle=h;let n=[].concat(a);for(let o=0;o<n.length;o++)this._ctx.fillText(n[o],(s+.5)*this._spacingX,Math.ceil((e+.5)*this._spacingY))}computeSize(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}computeFontSize(t,i){let s=Math.floor(t/this._options.width),e=Math.floor(i/this._options.height),a=this._ctx.font;this._ctx.font="100px "+this._options.fontFamily;let h=Math.ceil(this._ctx.measureText("W").width);this._ctx.font=a;let c=h/100*e/s;return c>1&&(e=Math.floor(e/c)),Math.floor(e/this._options.spacing)}_normalizedEventToPosition(t,i){return[Math.floor(t/this._spacingX),Math.floor(i/this._spacingY)]}_updateSize(){const t=this._options,i=Math.ceil(this._ctx.measureText("W").width);this._spacingX=Math.ceil(t.spacing*i),this._spacingY=Math.ceil(t.spacing*t.fontSize),t.forceSquareRatio&&(this._spacingX=this._spacingY=Math.max(this._spacingX,this._spacingY)),this._ctx.canvas.width=t.width*this._spacingX,this._ctx.canvas.height=t.height*this._spacingY}}return i.cache=!1,i})();var e=s;exports.default=e;
},{"./canvas.js":"dVhx"}],"QC1r":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./canvas.js"));function e(t){return t&&t.__esModule?t:{default:t}}class i extends t.default{constructor(){super(),this._colorCanvas=document.createElement("canvas")}draw(t,e){let[i,o,s,l,n]=t,r=this._options.tileWidth,a=this._options.tileHeight;if(e&&(this._options.tileColorize?this._ctx.clearRect(i*r,o*a,r,a):(this._ctx.fillStyle=n,this._ctx.fillRect(i*r,o*a,r,a))),!s)return;let h=[].concat(s),c=[].concat(l),d=[].concat(n);for(let p=0;p<h.length;p++){let t=this._options.tileMap[h[p]];if(!t)throw new Error(`Char "${h[p]}" not found in tileMap`);if(this._options.tileColorize){let e=this._colorCanvas,s=e.getContext("2d");s.globalCompositeOperation="source-over",s.clearRect(0,0,r,a);let l=c[p],n=d[p];s.drawImage(this._options.tileSet,t[0],t[1],r,a,0,0,r,a),"transparent"!=l&&(s.fillStyle=l,s.globalCompositeOperation="source-atop",s.fillRect(0,0,r,a)),"transparent"!=n&&(s.fillStyle=n,s.globalCompositeOperation="destination-over",s.fillRect(0,0,r,a)),this._ctx.drawImage(e,i*r,o*a,r,a)}else this._ctx.drawImage(this._options.tileSet,t[0],t[1],r,a,i*r,o*a,r,a)}}computeSize(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}_normalizedEventToPosition(t,e){return[Math.floor(t/this._options.tileWidth),Math.floor(e/this._options.tileHeight)]}_updateSize(){const t=this._options;this._ctx.canvas.width=t.width*t.tileWidth,this._ctx.canvas.height=t.height*t.tileHeight,this._colorCanvas.width=t.tileWidth,this._colorCanvas.height=t.tileHeight}}exports.default=i;
},{"./canvas.js":"dVhx"}],"ZPt1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.fromString=l,exports.add=a,exports.add_=n,exports.multiply=o,exports.multiply_=i,exports.interpolate=u,exports.interpolateHSL=d,exports.randomize=c,exports.rgb2hsl=h,exports.hsl2rgb=m,exports.toRGB=f,exports.toHex=b,exports.lerpHSL=exports.lerp=void 0;var e=require("./util.js"),r=t(require("./rng.js"));function t(e){return e&&e.__esModule?e:{default:e}}function l(e){let r,t;if(e in y)r=y[e];else{if("#"==e.charAt(0)){let t=(e.match(/[0-9a-f]/gi)||[]).map(e=>parseInt(e,16));if(3==t.length)r=t.map(e=>17*e);else{for(let e=0;e<3;e++)t[e+1]+=16*t[e],t.splice(e,1);r=t}}else r=(t=e.match(/rgb\(([0-9, ]+)\)/i))?t[1].split(/\s*,\s*/).map(e=>parseInt(e)):[0,0,0];y[e]=r}return r.slice()}function a(e,...r){let t=e.slice();for(let l=0;l<3;l++)for(let e=0;e<r.length;e++)t[l]+=r[e][l];return t}function n(e,...r){for(let t=0;t<3;t++)for(let l=0;l<r.length;l++)e[t]+=r[l][t];return e}function o(e,...r){let t=e.slice();for(let l=0;l<3;l++){for(let e=0;e<r.length;e++)t[l]*=r[e][l]/255;t[l]=Math.round(t[l])}return t}function i(e,...r){for(let t=0;t<3;t++){for(let l=0;l<r.length;l++)e[t]*=r[l][t]/255;e[t]=Math.round(e[t])}return e}function u(e,r,t=.5){let l=e.slice();for(let a=0;a<3;a++)l[a]=Math.round(l[a]+t*(r[a]-e[a]));return l}const s=u;function d(e,r,t=.5){let l=h(e),a=h(r);for(let n=0;n<3;n++)l[n]+=t*(a[n]-l[n]);return m(l)}exports.lerp=s;const g=d;function c(e,t){t instanceof Array||(t=Math.round(r.default.getNormal(0,t)));let l=e.slice();for(let a=0;a<3;a++)l[a]+=t instanceof Array?Math.round(r.default.getNormal(0,t[a])):t;return l}function h(e){let r,t=e[0]/255,l=e[1]/255,a=e[2]/255,n=Math.max(t,l,a),o=Math.min(t,l,a),i=0,u=(n+o)/2;if(n==o)r=0;else{let e=n-o;switch(r=u>.5?e/(2-n-o):e/(n+o),n){case t:i=(l-a)/e+(l<a?6:0);break;case l:i=(a-t)/e+2;break;case a:i=(t-l)/e+4}i/=6}return[i,r,u]}function p(e,r,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?e+6*(r-e)*t:t<.5?r:t<2/3?e+(r-e)*(2/3-t)*6:e}function m(e){let r=e[2];if(0==e[1])return[r=Math.round(255*r),r,r];{let t=e[1],l=r<.5?r*(1+t):r+t-r*t,a=2*r-l,n=p(a,l,e[0]+1/3),o=p(a,l,e[0]),i=p(a,l,e[0]-1/3);return[Math.round(255*n),Math.round(255*o),Math.round(255*i)]}}function f(r){return`rgb(${r.map(r=>(0,e.clamp)(r,0,255)).join(",")})`}function b(r){return`#${r.map(r=>(0,e.clamp)(r,0,255).toString(16).padStart(2,"0")).join("")}`}exports.lerpHSL=g;const y={black:[0,0,0],navy:[0,0,128],darkblue:[0,0,139],mediumblue:[0,0,205],blue:[0,0,255],darkgreen:[0,100,0],green:[0,128,0],teal:[0,128,128],darkcyan:[0,139,139],deepskyblue:[0,191,255],darkturquoise:[0,206,209],mediumspringgreen:[0,250,154],lime:[0,255,0],springgreen:[0,255,127],aqua:[0,255,255],cyan:[0,255,255],midnightblue:[25,25,112],dodgerblue:[30,144,255],forestgreen:[34,139,34],seagreen:[46,139,87],darkslategray:[47,79,79],darkslategrey:[47,79,79],limegreen:[50,205,50],mediumseagreen:[60,179,113],turquoise:[64,224,208],royalblue:[65,105,225],steelblue:[70,130,180],darkslateblue:[72,61,139],mediumturquoise:[72,209,204],indigo:[75,0,130],darkolivegreen:[85,107,47],cadetblue:[95,158,160],cornflowerblue:[100,149,237],mediumaquamarine:[102,205,170],dimgray:[105,105,105],dimgrey:[105,105,105],slateblue:[106,90,205],olivedrab:[107,142,35],slategray:[112,128,144],slategrey:[112,128,144],lightslategray:[119,136,153],lightslategrey:[119,136,153],mediumslateblue:[123,104,238],lawngreen:[124,252,0],chartreuse:[127,255,0],aquamarine:[127,255,212],maroon:[128,0,0],purple:[128,0,128],olive:[128,128,0],gray:[128,128,128],grey:[128,128,128],skyblue:[135,206,235],lightskyblue:[135,206,250],blueviolet:[138,43,226],darkred:[139,0,0],darkmagenta:[139,0,139],saddlebrown:[139,69,19],darkseagreen:[143,188,143],lightgreen:[144,238,144],mediumpurple:[147,112,216],darkviolet:[148,0,211],palegreen:[152,251,152],darkorchid:[153,50,204],yellowgreen:[154,205,50],sienna:[160,82,45],brown:[165,42,42],darkgray:[169,169,169],darkgrey:[169,169,169],lightblue:[173,216,230],greenyellow:[173,255,47],paleturquoise:[175,238,238],lightsteelblue:[176,196,222],powderblue:[176,224,230],firebrick:[178,34,34],darkgoldenrod:[184,134,11],mediumorchid:[186,85,211],rosybrown:[188,143,143],darkkhaki:[189,183,107],silver:[192,192,192],mediumvioletred:[199,21,133],indianred:[205,92,92],peru:[205,133,63],chocolate:[210,105,30],tan:[210,180,140],lightgray:[211,211,211],lightgrey:[211,211,211],palevioletred:[216,112,147],thistle:[216,191,216],orchid:[218,112,214],goldenrod:[218,165,32],crimson:[220,20,60],gainsboro:[220,220,220],plum:[221,160,221],burlywood:[222,184,135],lightcyan:[224,255,255],lavender:[230,230,250],darksalmon:[233,150,122],violet:[238,130,238],palegoldenrod:[238,232,170],lightcoral:[240,128,128],khaki:[240,230,140],aliceblue:[240,248,255],honeydew:[240,255,240],azure:[240,255,255],sandybrown:[244,164,96],wheat:[245,222,179],beige:[245,245,220],whitesmoke:[245,245,245],mintcream:[245,255,250],ghostwhite:[248,248,255],salmon:[250,128,114],antiquewhite:[250,235,215],linen:[250,240,230],lightgoldenrodyellow:[250,250,210],oldlace:[253,245,230],red:[255,0,0],fuchsia:[255,0,255],magenta:[255,0,255],deeppink:[255,20,147],orangered:[255,69,0],tomato:[255,99,71],hotpink:[255,105,180],coral:[255,127,80],darkorange:[255,140,0],lightsalmon:[255,160,122],orange:[255,165,0],lightpink:[255,182,193],pink:[255,192,203],gold:[255,215,0],peachpuff:[255,218,185],navajowhite:[255,222,173],moccasin:[255,228,181],bisque:[255,228,196],mistyrose:[255,228,225],blanchedalmond:[255,235,205],papayawhip:[255,239,213],lavenderblush:[255,240,245],seashell:[255,245,238],cornsilk:[255,248,220],lemonchiffon:[255,250,205],floralwhite:[255,250,240],snow:[255,250,250],yellow:[255,255,0],lightyellow:[255,255,224],ivory:[255,255,240],white:[255,255,255]};
},{"./util.js":"gHLf","./rng.js":"JPYe"}],"IBZc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=o(require("./backend.js")),t=i(require("../color.js"));function r(e){if("function"!=typeof WeakMap)return null;var t=new WeakMap,i=new WeakMap;return(r=function(e){return e?i:t})(e)}function i(e,t){if(!t&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var i=r(t);if(i&&i.has(e))return i.get(e);var o={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var a in e)if("default"!==a&&Object.prototype.hasOwnProperty.call(e,a)){var s=n?Object.getOwnPropertyDescriptor(e,a):null;s&&(s.get||s.set)?Object.defineProperty(o,a,s):o[a]=e[a]}return o.default=e,i&&i.set(e,o),o}function o(e){return e&&e.__esModule?e:{default:e}}class n extends e.default{constructor(){super(),this._uniforms={};try{this._gl=this._initWebGL()}catch(e){alert(e.message)}}static isSupported(){return!!document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0})}schedule(e){requestAnimationFrame(e)}getContainer(){return this._gl.canvas}setOptions(e){super.setOptions(e),this._updateSize();let t=this._options.tileSet;t&&"complete"in t&&!t.complete?t.addEventListener("load",()=>this._updateTexture(t)):this._updateTexture(t)}draw(e,t){const r=this._gl,i=this._options;let[o,n,a,s,l]=e,c=r.canvas.height-(n+1)*i.tileHeight;if(r.scissor(o*i.tileWidth,c,i.tileWidth,i.tileHeight),t&&(i.tileColorize?r.clearColor(0,0,0,0):r.clearColor(...g(l)),r.clear(r.COLOR_BUFFER_BIT)),!a)return;let u=[].concat(a),f=[].concat(l),h=[].concat(s);r.uniform2fv(this._uniforms.targetPosRel,[o,n]);for(let _=0;_<u.length;_++){let e=this._options.tileMap[u[_]];if(!e)throw new Error(`Char "${u[_]}" not found in tileMap`);r.uniform1f(this._uniforms.colorize,i.tileColorize?1:0),r.uniform2fv(this._uniforms.tilesetPosAbs,e),i.tileColorize&&(r.uniform4fv(this._uniforms.tint,g(h[_])),r.uniform4fv(this._uniforms.bg,g(f[_]))),r.drawArrays(r.TRIANGLE_STRIP,0,4)}}clear(){const e=this._gl;e.clearColor(...g(this._options.bg)),e.scissor(0,0,e.canvas.width,e.canvas.height),e.clear(e.COLOR_BUFFER_BIT)}computeSize(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}computeFontSize(){throw new Error("Tile backend does not understand font size")}eventToPosition(e,t){let r=this._gl.canvas,i=r.getBoundingClientRect();return e-=i.left,t-=i.top,e*=r.width/i.width,t*=r.height/i.height,e<0||t<0||e>=r.width||t>=r.height?[-1,-1]:this._normalizedEventToPosition(e,t)}_initWebGL(){let e=document.createElement("canvas").getContext("webgl2",{preserveDrawingBuffer:!0});window.gl=e;let t=c(e,s,l);return e.useProgram(t),u(e),a.forEach(r=>this._uniforms[r]=e.getUniformLocation(t,r)),this._program=t,e.enable(e.BLEND),e.blendFuncSeparate(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA,e.ONE,e.ONE_MINUS_SRC_ALPHA),e.enable(e.SCISSOR_TEST),e}_normalizedEventToPosition(e,t){return[Math.floor(e/this._options.tileWidth),Math.floor(t/this._options.tileHeight)]}_updateSize(){const e=this._gl,t=this._options,r=[t.width*t.tileWidth,t.height*t.tileHeight];e.canvas.width=r[0],e.canvas.height=r[1],e.viewport(0,0,r[0],r[1]),e.uniform2fv(this._uniforms.tileSize,[t.tileWidth,t.tileHeight]),e.uniform2fv(this._uniforms.targetSize,r)}_updateTexture(e){f(this._gl,e)}}exports.default=n;const a=["targetPosRel","tilesetPosAbs","tileSize","targetSize","colorize","bg","tint"],s="\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}".trim(),l="\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}".trim();function c(e,t,r){const i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,t),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i)||"");const o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,r),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(o)||"");const n=e.createProgram();if(e.attachShader(n,i),e.attachShader(n,o),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(n)||"");return n}function u(e){const t=new Float32Array([0,0,1,0,0,1,1,1]),r=e.createBuffer();e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW),e.enableVertexAttribArray(0),e.vertexAttribPointer(0,2,e.FLOAT,!1,0,0)}function f(e,t){let r=e.createTexture();return e.bindTexture(e.TEXTURE_2D,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,0),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),r}let h={};function g(e){if(!(e in h)){let r;if("transparent"==e)r=[0,0,0,0];else if(e.indexOf("rgba")>-1){r=(e.match(/[\d.]+/g)||[]).map(Number);for(let e=0;e<3;e++)r[e]=r[e]/255}else(r=t.fromString(e).map(e=>e/255)).push(1);h[e]=r}return h[e]}
},{"./backend.js":"R5vl","../color.js":"ZPt1"}],"pBGv":[function(require,module,exports) {

var t,e,n=module.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(t===setTimeout)return setTimeout(e,0);if((t===r||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function u(t){if(e===clearTimeout)return clearTimeout(t);if((e===o||!e)&&clearTimeout)return e=clearTimeout,clearTimeout(t);try{return e(t)}catch(n){try{return e.call(null,t)}catch(n){return e.call(this,t)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:r}catch(n){t=r}try{e="function"==typeof clearTimeout?clearTimeout:o}catch(n){e=o}}();var c,s=[],l=!1,a=-1;function f(){l&&c&&(l=!1,c.length?s=c.concat(s):a=-1,s.length&&h())}function h(){if(!l){var t=i(f);l=!0;for(var e=s.length;e;){for(c=s,s=[];++a<e;)c&&c[a].run();a=-1,e=s.length}c=null,l=!1,u(t)}}function m(t,e){this.fun=t,this.array=e}function p(){}n.nextTick=function(t){var e=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)e[n-1]=arguments[n];s.push(new m(t,e)),1!==s.length||l||i(h)},m.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.env={},n.argv=[],n.version="",n.versions={},n.on=p,n.addListener=p,n.once=p,n.off=p,n.removeListener=p,n.removeAllListeners=p,n.emit=p,n.prependListener=p,n.prependOnceListener=p,n.listeners=function(t){return[]},n.binding=function(t){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(t){throw new Error("process.chdir is not supported")},n.umask=function(){return 0};
},{}],"BC3l":[function(require,module,exports) {
var process = require("process");
var t=require("process");Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=u(require("./backend.js")),r=s(require("../color.js"));function o(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,r=new WeakMap;return(o=function(t){return t?r:e})(t)}function s(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var r=o(e);if(r&&r.has(t))return r.get(t);var s={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var i in t)if("default"!==i&&Object.prototype.hasOwnProperty.call(t,i)){var n=u?Object.getOwnPropertyDescriptor(t,i):null;n&&(n.get||n.set)?Object.defineProperty(s,i,n):s[i]=t[i]}return s.default=t,r&&r.set(t,s),s}function u(t){return t&&t.__esModule?t:{default:t}}function i(t){return`[0;48;5;${c(t)}m[2J`}function n(t,e){return`[0;38;5;${c(t)};48;5;${c(e)}m`}function f(t,e){return`[${e+1};${t+1}H`}function c(t){let e=r.fromString(t);return 36*Math.floor(e[0]*(6/256))+6*Math.floor(e[1]*(6/256))+1*Math.floor(e[2]*(6/256))+16}class a extends e.default{constructor(){super(),this._offset=[0,0],this._cursor=[-1,-1],this._lastColor=""}schedule(t){setTimeout(t,1e3/60)}setOptions(t){super.setOptions(t);let e=[t.width,t.height],r=this.computeSize();this._offset=r.map((t,r)=>Math.floor((t-e[r])/2))}clear(){t.stdout.write(i(this._options.bg))}draw(e,r){let[o,s,u,i,c]=e,a=this._offset[0]+o,l=this._offset[1]+s,h=this.computeSize();if(a<0||a>=h[0])return;if(l<0||l>=h[1])return;if(a===this._cursor[0]&&l===this._cursor[1]||(t.stdout.write(f(a,l)),this._cursor[0]=a,this._cursor[1]=l),r&&(u||(u=" ")),!u)return;let p=n(i,c);if(p!==this._lastColor&&(t.stdout.write(p),this._lastColor=p),"\t"!=u){let e=[].concat(u);t.stdout.write(e[0])}this._cursor[0]++,this._cursor[0]>=h[0]&&(this._cursor[0]=0,this._cursor[1]++)}computeFontSize(){throw new Error("Terminal backend has no notion of font size")}eventToPosition(t,e){return[t,e]}computeSize(){return[t.stdout.columns,t.stdout.rows]}}exports.default=a;
},{"./backend.js":"R5vl","../color.js":"ZPt1","process":"pBGv"}],"nEBA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.measure=s,exports.tokenize=r,exports.TYPE_BG=exports.TYPE_FG=exports.TYPE_NEWLINE=exports.TYPE_TEXT=void 0;const e=/%([bc]){([^}]*)}/g,t=0;exports.TYPE_TEXT=t;const l=1;exports.TYPE_NEWLINE=l;const n=2;exports.TYPE_FG=n;const u=3;function s(e,n){let u={width:0,height:1},s=r(e,n),i=0;for(let r=0;r<s.length;r++){let e=s[r];switch(e.type){case t:i+=e.value.length;break;case l:u.height++,u.width=Math.max(u.width,i),i=0}}return u.width=Math.max(u.width,i),u}function r(l,s){let r=[],a=0;l.replace(e,function(e,s,i,o){let p=l.substring(a,o);return p.length&&r.push({type:t,value:p}),r.push({type:"c"==s?n:u,value:i.trim()}),a=o+e.length,""});let o=l.substring(a);return o.length&&r.push({type:t,value:o}),i(r,s)}function i(e,n){n||(n=1/0);let u=0,s=0,r=-1;for(;u<e.length;){let i=e[u];if(i.type==l&&(s=0,r=-1),i.type!=t){u++;continue}for(;0==s&&" "==i.value.charAt(0);)i.value=i.value.substring(1);let o=i.value.indexOf("\n");if(-1!=o){i.value=a(e,u,o,!0);let t=i.value.split("");for(;t.length&&" "==t[t.length-1];)t.pop();i.value=t.join("")}if(i.value.length){if(s+i.value.length>n){let t=-1;for(;;){let e=i.value.indexOf(" ",t+1);if(-1==e)break;if(s+e>n)break;t=e}if(-1!=t)i.value=a(e,u,t,!0);else if(-1!=r){let t=e[r],l=t.value.lastIndexOf(" ");t.value=a(e,r,l,!0),u=r}else i.value=a(e,u,n-s,!1)}else s+=i.value.length,-1!=i.value.indexOf(" ")&&(r=u);u++}else e.splice(u,1)}e.push({type:l});let i=null;for(let a=0;a<e.length;a++){let n=e[a];switch(n.type){case t:i=n;break;case l:if(i){let e=i.value.split("");for(;e.length&&" "==e[e.length-1];)e.pop();i.value=e.join("")}i=null}}return e.pop(),e}function a(e,n,u,s){let r={type:l},i={type:t,value:e[n].value.substring(u+(s?1:0))};return e.splice(n+1,0,r,i),e[n].value.substring(0,u)}exports.TYPE_BG=u;
},{}],"XzVr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.KEYS=exports.DIRS=exports.DEFAULT_HEIGHT=exports.DEFAULT_WIDTH=void 0;let _=80;exports.DEFAULT_WIDTH=_;let K=25;exports.DEFAULT_HEIGHT=K;const V={4:[[0,-1],[1,0],[0,1],[-1,0]],8:[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]],6:[[-1,-1],[1,-1],[2,0],[1,1],[-1,1],[-2,0]]};exports.DIRS=V;const E={VK_CANCEL:3,VK_HELP:6,VK_BACK_SPACE:8,VK_TAB:9,VK_CLEAR:12,VK_RETURN:13,VK_ENTER:14,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_PAUSE:19,VK_CAPS_LOCK:20,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_PRINTSCREEN:44,VK_INSERT:45,VK_DELETE:46,VK_0:48,VK_1:49,VK_2:50,VK_3:51,VK_4:52,VK_5:53,VK_6:54,VK_7:55,VK_8:56,VK_9:57,VK_COLON:58,VK_SEMICOLON:59,VK_LESS_THAN:60,VK_EQUALS:61,VK_GREATER_THAN:62,VK_QUESTION_MARK:63,VK_AT:64,VK_A:65,VK_B:66,VK_C:67,VK_D:68,VK_E:69,VK_F:70,VK_G:71,VK_H:72,VK_I:73,VK_J:74,VK_K:75,VK_L:76,VK_M:77,VK_N:78,VK_O:79,VK_P:80,VK_Q:81,VK_R:82,VK_S:83,VK_T:84,VK_U:85,VK_V:86,VK_W:87,VK_X:88,VK_Y:89,VK_Z:90,VK_CONTEXT_MENU:93,VK_NUMPAD0:96,VK_NUMPAD1:97,VK_NUMPAD2:98,VK_NUMPAD3:99,VK_NUMPAD4:100,VK_NUMPAD5:101,VK_NUMPAD6:102,VK_NUMPAD7:103,VK_NUMPAD8:104,VK_NUMPAD9:105,VK_MULTIPLY:106,VK_ADD:107,VK_SEPARATOR:108,VK_SUBTRACT:109,VK_DECIMAL:110,VK_DIVIDE:111,VK_F1:112,VK_F2:113,VK_F3:114,VK_F4:115,VK_F5:116,VK_F6:117,VK_F7:118,VK_F8:119,VK_F9:120,VK_F10:121,VK_F11:122,VK_F12:123,VK_F13:124,VK_F14:125,VK_F15:126,VK_F16:127,VK_F17:128,VK_F18:129,VK_F19:130,VK_F20:131,VK_F21:132,VK_F22:133,VK_F23:134,VK_F24:135,VK_NUM_LOCK:144,VK_SCROLL_LOCK:145,VK_CIRCUMFLEX:160,VK_EXCLAMATION:161,VK_DOUBLE_QUOTE:162,VK_HASH:163,VK_DOLLAR:164,VK_PERCENT:165,VK_AMPERSAND:166,VK_UNDERSCORE:167,VK_OPEN_PAREN:168,VK_CLOSE_PAREN:169,VK_ASTERISK:170,VK_PLUS:171,VK_PIPE:172,VK_HYPHEN_MINUS:173,VK_OPEN_CURLY_BRACKET:174,VK_CLOSE_CURLY_BRACKET:175,VK_TILDE:176,VK_COMMA:188,VK_PERIOD:190,VK_SLASH:191,VK_BACK_QUOTE:192,VK_OPEN_BRACKET:219,VK_BACK_SLASH:220,VK_CLOSE_BRACKET:221,VK_QUOTE:222,VK_META:224,VK_ALTGR:225,VK_WIN:91,VK_KANA:21,VK_HANGUL:21,VK_EISU:22,VK_JUNJA:23,VK_FINAL:24,VK_HANJA:25,VK_KANJI:25,VK_CONVERT:28,VK_NONCONVERT:29,VK_ACCEPT:30,VK_MODECHANGE:31,VK_SELECT:41,VK_PRINT:42,VK_EXECUTE:43,VK_SLEEP:95};exports.KEYS=E;
},{}],"A2Km":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=h(require("./hex.js")),e=h(require("./rect.js")),i=h(require("./tile.js")),r=h(require("./tile-gl.js")),s=h(require("./term.js")),n=l(require("../text.js")),o=require("../constants.js");function a(t){if("function"!=typeof WeakMap)return null;var e=new WeakMap,i=new WeakMap;return(a=function(t){return t?i:e})(t)}function l(t,e){if(!e&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var i=a(e);if(i&&i.has(t))return i.get(t);var r={},s=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var n in t)if("default"!==n&&Object.prototype.hasOwnProperty.call(t,n)){var o=s?Object.getOwnPropertyDescriptor(t,n):null;o&&(o.get||o.set)?Object.defineProperty(r,n,o):r[n]=t[n]}return r.default=t,i&&i.set(t,r),r}function h(t){return t&&t.__esModule?t:{default:t}}const u={hex:t.default,rect:e.default,tile:i.default,"tile-gl":r.default,term:s.default},c={width:o.DEFAULT_WIDTH,height:o.DEFAULT_HEIGHT,transpose:!1,layout:"rect",fontSize:15,spacing:1,border:0,forceSquareRatio:!1,fontFamily:"monospace",fontStyle:"",fg:"#ccc",bg:"#000",tileWidth:32,tileHeight:32,tileMap:{},tileSet:null,tileColorize:!1};let d=(()=>{class o{constructor(t={}){this._data={},this._dirty=!1,this._options={},t=Object.assign({},c,t),this.setOptions(t),this.DEBUG=this.DEBUG.bind(this),this._tick=this._tick.bind(this),this._backend.schedule(this._tick)}DEBUG(t,e,i){let r=[this._options.bg,this._options.fg];this.draw(t,e,null,null,r[i%r.length])}clear(){this._data={},this._dirty=!0}setOptions(t){if(Object.assign(this._options,t),t.width||t.height||t.fontSize||t.fontFamily||t.spacing||t.layout){if(t.layout){let e=u[t.layout];this._backend=new e}this._backend.setOptions(this._options),this._dirty=!0}return this}getOptions(){return this._options}getContainer(){return this._backend.getContainer()}computeSize(t,e){return this._backend.computeSize(t,e)}computeFontSize(t,e){return this._backend.computeFontSize(t,e)}computeTileSize(t,e){return[Math.floor(t/this._options.width),Math.floor(e/this._options.height)]}eventToPosition(t){let e,i;return"touches"in t?(e=t.touches[0].clientX,i=t.touches[0].clientY):(e=t.clientX,i=t.clientY),this._backend.eventToPosition(e,i)}draw(t,e,i,r,s){r||(r=this._options.fg),s||(s=this._options.bg);let n=`${t},${e}`;this._data[n]=[t,e,i,r,s],!0!==this._dirty&&(this._dirty||(this._dirty={}),this._dirty[n]=!0)}drawOver(t,e,i,r,s){const n=`${t},${e}`,o=this._data[n];o?(o[2]=i||o[2],o[3]=r||o[3],o[4]=s||o[4]):this.draw(t,e,i,r,s)}drawText(t,e,i,r){let s=null,o=null,a=t,l=e,h=1;r||(r=this._options.width-t);let u=n.tokenize(i,r);for(;u.length;){let e=u.shift();switch(e.type){case n.TYPE_TEXT:let i=!1,r=!1,u=!1,c=!1;for(let t=0;t<e.value.length;t++){let n=e.value.charCodeAt(t),h=e.value.charAt(t);if("term"===this._options.layout){let t=n>>8;if(17===t||t>=46&&t<=159||t>=172&&t<=215||n>=43360&&n<=43391){this.draw(a+0,l,h,s,o),this.draw(a+1,l,"\t",s,o),a+=2;continue}}u=n>65280&&n<65377||n>65500&&n<65512||n>65518,i=32==h.charCodeAt(0)||12288==h.charCodeAt(0),!c||u||i||a++,u&&!r&&a++,this.draw(a++,l,h,s,o),r=i,c=u}break;case n.TYPE_FG:s=e.value||null;break;case n.TYPE_BG:o=e.value||null;break;case n.TYPE_NEWLINE:a=t,l++,h++}}return h}_tick(){if(this._backend.schedule(this._tick),this._dirty){if(!0===this._dirty){this._backend.clear();for(let t in this._data)this._draw(t,!1)}else for(let t in this._dirty)this._draw(t,!0);this._dirty=!1}}_draw(t,e){let i=this._data[t];i[4]!=this._options.bg&&(e=!0),this._backend.draw(i,e)}}return o.Rect=e.default,o.Hex=t.default,o.Tile=i.default,o.TileGL=r.default,o.Term=s.default,o})();var _=d;exports.default=_;
},{"./hex.js":"NVkk","./rect.js":"s7HM","./tile.js":"QC1r","./tile-gl.js":"IBZc","./term.js":"BC3l","../text.js":"nEBA","../constants.js":"XzVr"}],"sRzJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("./rng.js"));function s(t){return t&&t.__esModule?t:{default:t}}class i{constructor(t){this._options={words:!1,order:3,prior:.001},Object.assign(this._options,t),this._boundary=String.fromCharCode(0),this._suffix=this._boundary,this._prefix=[];for(let s=0;s<this._options.order;s++)this._prefix.push(this._boundary);this._priorValues={},this._priorValues[this._boundary]=this._options.prior,this._data={}}clear(){this._data={},this._priorValues={}}generate(){let t=[this._sample(this._prefix)];for(;t[t.length-1]!=this._boundary;)t.push(this._sample(t));return this._join(t.slice(0,-1))}observe(t){let s=this._split(t);for(let i=0;i<s.length;i++)this._priorValues[s[i]]=this._options.prior;s=this._prefix.concat(s).concat(this._suffix);for(let i=this._options.order;i<s.length;i++){let t=s.slice(i-this._options.order,i),e=s[i];for(let s=0;s<t.length;s++){let i=t.slice(s);this._observeEvent(i,e)}}}getStats(){let t=[],s=Object.keys(this._priorValues).length;s--,t.push("distinct samples: "+s);let i=Object.keys(this._data).length,e=0;for(let r in this._data)e+=Object.keys(this._data[r]).length;return t.push("dictionary size (contexts): "+i),t.push("dictionary size (events): "+e),t.join(", ")}_split(t){return t.split(this._options.words?/\s+/:"")}_join(t){return t.join(this._options.words?" ":"")}_observeEvent(t,s){let i=this._join(t);i in this._data||(this._data[i]={});let e=this._data[i];s in e||(e[s]=0),e[s]++}_sample(s){s=this._backoff(s);let i=this._join(s),e=this._data[i],r={};if(this._options.prior){for(let t in this._priorValues)r[t]=this._priorValues[t];for(let t in e)r[t]+=e[t]}else r=e;return t.default.getWeightedValue(r)}_backoff(t){for(t.length>this._options.order?t=t.slice(-this._options.order):t.length<this._options.order&&(t=this._prefix.slice(0,this._options.order-t.length).concat(t));!(this._join(t)in this._data)&&t.length>0;)t=t.slice(1);return t}}exports.default=i;
},{"./rng.js":"JPYe"}],"daEA":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.MinHeap=void 0;class t{constructor(){this.heap=[],this.timestamp=0}lessThan(t,e){return t.key==e.key?t.timestamp<e.timestamp:t.key<e.key}shift(t){this.heap=this.heap.map(({key:e,value:s,timestamp:h})=>({key:e+t,value:s,timestamp:h}))}len(){return this.heap.length}push(t,e){this.timestamp+=1;const s=this.len();this.heap.push({value:t,timestamp:this.timestamp,key:e}),this.updateUp(s)}pop(){if(0==this.len())throw new Error("no element to pop");const t=this.heap[0];return this.len()>1?(this.heap[0]=this.heap.pop(),this.updateDown(0)):this.heap.pop(),t}find(t){for(let e=0;e<this.len();e++)if(t==this.heap[e].value)return this.heap[e];return null}remove(t){let e=null;for(let s=0;s<this.len();s++)t==this.heap[s].value&&(e=s);if(null===e)return!1;if(this.len()>1){let s=this.heap.pop();return s.value!=t&&(this.heap[e]=s,this.updateDown(e)),!0}return this.heap.pop(),!0}parentNode(t){return Math.floor((t-1)/2)}leftChildNode(t){return 2*t+1}rightChildNode(t){return 2*t+2}existNode(t){return t>=0&&t<this.heap.length}swap(t,e){const s=this.heap[t];this.heap[t]=this.heap[e],this.heap[e]=s}minNode(t){const e=t.filter(this.existNode.bind(this));let s=e[0];for(const h of e)this.lessThan(this.heap[h],this.heap[s])&&(s=h);return s}updateUp(t){if(0==t)return;const e=this.parentNode(t);this.existNode(e)&&this.lessThan(this.heap[t],this.heap[e])&&(this.swap(t,e),this.updateUp(e))}updateDown(t){const e=this.leftChildNode(t),s=this.rightChildNode(t);if(!this.existNode(e))return;const h=this.minNode([t,e,s]);h!=t&&(this.swap(t,h),this.updateDown(h))}debugPrint(){console.log(this.heap)}}exports.MinHeap=t;
},{}],"JnHK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=require("./MinHeap.js");class t{constructor(){this._time=0,this._events=new e.MinHeap}getTime(){return this._time}clear(){return this._events=new e.MinHeap,this}add(e,t){this._events.push(e,t)}get(){if(!this._events.len())return null;let{key:e,value:t}=this._events.pop();return e>0&&(this._time+=e,this._events.shift(-e)),t}getEventTime(e){const t=this._events.find(e);if(t){const{key:e}=t;return e}}remove(e){return this._events.remove(e)}}exports.default=t;
},{"./MinHeap.js":"daEA"}],"ZRGc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("../eventqueue.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r{constructor(){this._queue=new e.default,this._repeat=[],this._current=null}getTime(){return this._queue.getTime()}add(e,t){return t&&this._repeat.push(e),this}getTimeOf(e){return this._queue.getEventTime(e)}clear(){return this._queue.clear(),this._repeat=[],this._current=null,this}remove(e){let t=this._queue.remove(e),r=this._repeat.indexOf(e);return-1!=r&&this._repeat.splice(r,1),this._current==e&&(this._current=null),t}next(){return this._current=this._queue.get(),this._current}}exports.default=r;
},{"../eventqueue.js":"JnHK"}],"h1bt":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./scheduler.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r extends e.default{add(e,t){return this._queue.add(e,0),super.add(e,t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,0),super.next()}}exports.default=r;
},{"./scheduler.js":"ZRGc"}],"tmo5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./scheduler.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r extends e.default{add(e,t,r){return this._queue.add(e,void 0!==r?r:1/e.getSpeed()),super.add(e,t)}next(){return this._current&&-1!=this._repeat.indexOf(this._current)&&this._queue.add(this._current,1/this._current.getSpeed()),super.next()}}exports.default=r;
},{"./scheduler.js":"ZRGc"}],"ttuk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./scheduler.js"));function e(t){return t&&t.__esModule?t:{default:t}}class r extends t.default{constructor(){super(),this._defaultDuration=1,this._duration=this._defaultDuration}add(t,e,r){return this._queue.add(t,r||this._defaultDuration),super.add(t,e)}clear(){return this._duration=this._defaultDuration,super.clear()}remove(t){return t==this._current&&(this._duration=this._defaultDuration),super.remove(t)}next(){return null!==this._current&&-1!=this._repeat.indexOf(this._current)&&(this._queue.add(this._current,this._duration||this._defaultDuration),this._duration=this._defaultDuration),super.next()}setDuration(t){return this._current&&(this._duration=t),this}}exports.default=r;
},{"./scheduler.js":"ZRGc"}],"kH2E":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=u(require("./simple.js")),t=u(require("./speed.js")),r=u(require("./action.js"));function u(e){return e&&e.__esModule?e:{default:e}}var d={Simple:e.default,Speed:t.default,Action:r.default};exports.default=d;
},{"./simple.js":"h1bt","./speed.js":"tmo5","./action.js":"ttuk"}],"VrfJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("../constants.js");class e{constructor(t,e={}){this._lightPasses=t,this._options=Object.assign({topology:8},e)}_getCircle(e,o,s){let r,a,l,c=[];switch(this._options.topology){case 4:a=1,l=[0,1],r=[t.DIRS[8][7],t.DIRS[8][1],t.DIRS[8][3],t.DIRS[8][5]];break;case 6:r=t.DIRS[6],a=1,l=[-1,1];break;case 8:r=t.DIRS[4],a=2,l=[-1,1];break;default:throw new Error("Incorrect topology for FOV computation")}let i=e+l[0]*s,n=o+l[1]*s;for(let t=0;t<r.length;t++)for(let e=0;e<s*a;e++)c.push([i,n]),i+=r[t][0],n+=r[t][1];return c}}exports.default=e;
},{"../constants.js":"XzVr"}],"PUaL":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./fov.js"));function t(e){return e&&e.__esModule?e:{default:e}}class s extends e.default{compute(e,t,s,l){if(l(e,t,0,1),!this._lightPasses(e,t))return;let r,i,o,u,f,h=[];for(let n=1;n<=s;n++){let s=this._getCircle(e,t,n),d=360/s.length;for(let e=0;e<s.length;e++)if(o=s[e][0],u=s[e][1],i=(r=d*(e-.5))+d,f=!this._lightPasses(o,u),this._visibleCoords(Math.floor(r),Math.ceil(i),f,h)&&l(o,u,n,1),2==h.length&&0==h[0]&&360==h[1])return}}_visibleCoords(e,t,s,l){if(e<0){let r=this._visibleCoords(0,t,s,l),i=this._visibleCoords(360+e,360,s,l);return r||i}let r=0;for(;r<l.length&&l[r]<e;)r++;if(r==l.length)return s&&l.push(e,t),!0;let i=0;if(r%2){for(;r<l.length&&l[r]<t;)r++,i++;return 0!=i&&(s&&(i%2?l.splice(r-i,i,t):l.splice(r-i,i)),!0)}for(;r<l.length&&l[r]<t;)r++,i++;return(e!=l[r-i]||1!=i)&&(s&&(i%2?l.splice(r-i,i,e):l.splice(r-i,i,e,t)),!0)}}exports.default=s;
},{"./fov.js":"VrfJ"}],"Mzjf":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./fov.js"));function t(e){return e&&e.__esModule?e:{default:e}}class i extends e.default{compute(e,t,i,l){if(l(e,t,0,1),!this._lightPasses(e,t))return;let s,r,f,c,u,h,n=[];for(let o=1;o<=i;o++){let i=this._getCircle(e,t,o),a=i.length;for(let e=0;e<a;e++)if(s=i[e][0],r=i[e][1],c=[e?2*e-1:2*a-1,2*a],u=[2*e+1,2*a],f=!this._lightPasses(s,r),(h=this._checkVisibility(c,u,f,n))&&l(s,r,o,h),2==n.length&&0==n[0][0]&&n[1][0]==n[1][1])return}}_checkVisibility(e,t,i,l){if(e[0]>t[0]){return(this._checkVisibility(e,[e[1],e[1]],i,l)+this._checkVisibility([0,1],t,i,l))/2}let s=0,r=!1;for(;s<l.length;){let t=l[s],i=t[0]*e[1]-e[0]*t[1];if(i>=0){0!=i||s%2||(r=!0);break}s++}let f=l.length,c=!1;for(;f--;){let e=l[f],i=t[0]*e[1]-e[0]*t[1];if(i>=0){0==i&&f%2&&(c=!0);break}}let u,h=!0;if(s==f&&(r||c)?h=!1:r&&c&&s+1==f&&f%2?h=!1:s>f&&s%2&&(h=!1),!h)return 0;let n=f-s+1;if(n%2)if(s%2){let e=l[s];u=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&l.splice(s,n,t)}else{let t=l[f];u=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&l.splice(s,n,e)}else{if(!(s%2))return i&&l.splice(s,n,e,t),1;{let e=l[s],t=l[f];u=(t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]),i&&l.splice(s,n)}}return u/((t[0]*e[1]-e[0]*t[1])/(e[1]*t[1]))}}exports.default=i;
},{"./fov.js":"VrfJ"}],"cKxs":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./fov.js"));function e(t){return t&&t.__esModule?t:{default:t}}const i=[[-1,0,0,1],[0,-1,1,0],[0,-1,-1,0],[-1,0,0,-1],[1,0,0,-1],[0,1,-1,0],[0,1,1,0],[1,0,0,1]];class s extends t.default{compute(t,e,s,r){r(t,e,0,1);for(let n=0;n<i.length;n++)this._renderOctant(t,e,i[n],s,r)}compute180(t,e,s,r,n){n(t,e,0,1);let a=(r-1+8)%8,l=(r-2+8)%8,c=(r+1+8)%8;this._renderOctant(t,e,i[l],s,n),this._renderOctant(t,e,i[a],s,n),this._renderOctant(t,e,i[r],s,n),this._renderOctant(t,e,i[c],s,n)}compute90(t,e,s,r,n){n(t,e,0,1);let a=(r-1+8)%8;this._renderOctant(t,e,i[r],s,n),this._renderOctant(t,e,i[a],s,n)}_renderOctant(t,e,i,s,r){this._castVisibility(t,e,1,1,0,s+1,i[0],i[1],i[2],i[3],r)}_castVisibility(t,e,i,s,r,n,a,l,c,d,o){if(!(s<r))for(let _=i;_<=n;_++){let i=-_-1,f=-_,u=!1,h=0;for(;i<=0;){let O=t+(i+=1)*a+f*l,p=e+i*c+f*d,b=(i-.5)/(f+.5),v=(i+.5)/(f-.5);if(!(v>s)){if(b<r)break;if(i*i+f*f<n*n&&o(O,p,_,1),u){if(!this._lightPasses(O,p)){h=v;continue}u=!1,s=h}else!this._lightPasses(O,p)&&_<n&&(u=!0,this._castVisibility(t,e,_+1,s,b,n,a,l,c,d,o),h=v)}}if(u)break}}}exports.default=s;
},{"./fov.js":"VrfJ"}],"jqIP":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./discrete-shadowcasting.js")),s=t(require("./precise-shadowcasting.js")),r=t(require("./recursive-shadowcasting.js"));function t(e){return e&&e.__esModule?e:{default:e}}var a={DiscreteShadowcasting:e.default,PreciseShadowcasting:s.default,RecursiveShadowcasting:r.default};exports.default=a;
},{"./discrete-shadowcasting.js":"PUaL","./precise-shadowcasting.js":"Mzjf","./recursive-shadowcasting.js":"cKxs"}],"a9E1":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=require("../constants.js");class e{constructor(e=t.DEFAULT_WIDTH,s=t.DEFAULT_HEIGHT){this._width=e,this._height=s}_fillMap(t){let e=[];for(let s=0;s<this._width;s++){e.push([]);for(let r=0;r<this._height;r++)e[s].push(t)}return e}}exports.default=e;
},{"../constants.js":"XzVr"}],"qL5h":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./map.js"));function t(e){return e&&e.__esModule?e:{default:e}}class r extends e.default{create(e){let t=this._width-1,r=this._height-1;for(let s=0;s<=t;s++)for(let u=0;u<=r;u++){e(s,u,s&&u&&s<t&&u<r?0:1)}return this}}exports.default=r;
},{"./map.js":"a9E1"}],"aBaJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r=e(require("./map.js"));function e(r){return r&&r.__esModule?r:{default:r}}class t extends r.default{constructor(r,e){super(r,e),this._rooms=[],this._corridors=[]}getRooms(){return this._rooms}getCorridors(){return this._corridors}}exports.default=t;
},{"./map.js":"a9E1"}],"ynS2":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Corridor=exports.Room=void 0;var t=e(require("../rng.js"));function e(t){return t&&t.__esModule?t:{default:t}}class r{}class i extends r{constructor(t,e,r,i,s,o){super(),this._x1=t,this._y1=e,this._x2=r,this._y2=i,this._doors={},void 0!==s&&void 0!==o&&this.addDoor(s,o)}static createRandomAt(e,r,i,s,o){let h=o.roomWidth[0],n=o.roomWidth[1],a=t.default.getUniformInt(h,n);h=o.roomHeight[0],n=o.roomHeight[1];let d=t.default.getUniformInt(h,n);if(1==i){let i=r-Math.floor(t.default.getUniform()*d);return new this(e+1,i,e+a,i+d-1,e,r)}if(-1==i){let i=r-Math.floor(t.default.getUniform()*d);return new this(e-a,i,e-1,i+d-1,e,r)}if(1==s){let i=e-Math.floor(t.default.getUniform()*a);return new this(i,r+1,i+a-1,r+d,e,r)}if(-1==s){let i=e-Math.floor(t.default.getUniform()*a);return new this(i,r-d,i+a-1,r-1,e,r)}throw new Error("dx or dy must be 1 or -1")}static createRandomCenter(e,r,i){let s=i.roomWidth[0],o=i.roomWidth[1],h=t.default.getUniformInt(s,o);s=i.roomHeight[0],o=i.roomHeight[1];let n=t.default.getUniformInt(s,o),a=e-Math.floor(t.default.getUniform()*h),d=r-Math.floor(t.default.getUniform()*n);return new this(a,d,a+h-1,d+n-1)}static createRandom(e,r,i){let s=i.roomWidth[0],o=i.roomWidth[1],h=t.default.getUniformInt(s,o);s=i.roomHeight[0],o=i.roomHeight[1];let n=t.default.getUniformInt(s,o),a=e-h-1,d=r-n-1,l=1+Math.floor(t.default.getUniform()*a),_=1+Math.floor(t.default.getUniform()*d);return new this(l,_,l+h-1,_+n-1)}addDoor(t,e){return this._doors[t+","+e]=1,this}getDoors(t){for(let e in this._doors){let r=e.split(",");t(parseInt(r[0]),parseInt(r[1]))}return this}clearDoors(){return this._doors={},this}addDoors(t){let e=this._x1-1,r=this._x2+1,i=this._y1-1,s=this._y2+1;for(let o=e;o<=r;o++)for(let h=i;h<=s;h++)o!=e&&o!=r&&h!=i&&h!=s||t(o,h)||this.addDoor(o,h);return this}debug(){console.log("room",this._x1,this._y1,this._x2,this._y2)}isValid(t,e){let r=this._x1-1,i=this._x2+1,s=this._y1-1,o=this._y2+1;for(let h=r;h<=i;h++)for(let n=s;n<=o;n++)if(h==r||h==i||n==s||n==o){if(!t(h,n))return!1}else if(!e(h,n))return!1;return!0}create(t){let e=this._x1-1,r=this._x2+1,i=this._y1-1,s=this._y2+1,o=0;for(let h=e;h<=r;h++)for(let n=i;n<=s;n++)t(h,n,o=h+","+n in this._doors?2:h==e||h==r||n==i||n==s?1:0)}getCenter(){return[Math.round((this._x1+this._x2)/2),Math.round((this._y1+this._y2)/2)]}getLeft(){return this._x1}getRight(){return this._x2}getTop(){return this._y1}getBottom(){return this._y2}}exports.Room=i;class s extends r{constructor(t,e,r,i){super(),this._startX=t,this._startY=e,this._endX=r,this._endY=i,this._endsWithAWall=!0}static createRandomAt(e,r,i,s,o){let h=o.corridorLength[0],n=o.corridorLength[1],a=t.default.getUniformInt(h,n);return new this(e,r,e+i*a,r+s*a)}debug(){console.log("corridor",this._startX,this._startY,this._endX,this._endY)}isValid(t,e){let r=this._startX,i=this._startY,s=this._endX-r,o=this._endY-i,h=1+Math.max(Math.abs(s),Math.abs(o));s&&(s/=Math.abs(s)),o&&(o/=Math.abs(o));let n=o,a=-s,d=!0;for(let f=0;f<h;f++){let l=r+f*s,_=i+f*o;if(e(l,_)||(d=!1),t(l+n,_+a)||(d=!1),t(l-n,_-a)||(d=!1),!d){h=f,this._endX=l-s,this._endY=_-o;break}}if(0==h)return!1;if(1==h&&t(this._endX+s,this._endY+o))return!1;let l=!t(this._endX+s+n,this._endY+o+a),_=!t(this._endX+s-n,this._endY+o-a);return this._endsWithAWall=t(this._endX+s,this._endY+o),!l&&!_||!this._endsWithAWall}create(t){let e=this._startX,r=this._startY,i=this._endX-e,s=this._endY-r,o=1+Math.max(Math.abs(i),Math.abs(s));i&&(i/=Math.abs(i)),s&&(s/=Math.abs(s));for(let h=0;h<o;h++){t(e+h*i,r+h*s,0)}return!0}createPriorityWalls(t){if(!this._endsWithAWall)return;let e=this._startX,r=this._startY,i=this._endX-e,s=this._endY-r;i&&(i/=Math.abs(i)),s&&(s/=Math.abs(s));let o=s,h=-i;t(this._endX+i,this._endY+s),t(this._endX+o,this._endY+h),t(this._endX-o,this._endY-h)}}exports.Corridor=s;
},{"../rng.js":"JPYe"}],"mUAp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("./dungeon.js")),e=require("./features.js"),i=s(require("../rng.js"));function s(t){return t&&t.__esModule?t:{default:t}}class o extends t.default{constructor(t,e,i){super(t,e),this._options={roomWidth:[3,9],roomHeight:[3,5],roomDugPercentage:.1,timeLimit:1e3},Object.assign(this._options,i),this._map=[],this._dug=0,this._roomAttempts=20,this._corridorAttempts=20,this._connected=[],this._unconnected=[],this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this)}create(t){let e=Date.now();for(;;){if(Date.now()-e>this._options.timeLimit)return null;if(this._map=this._fillMap(1),this._dug=0,this._rooms=[],this._unconnected=[],this._generateRooms(),!(this._rooms.length<2)&&this._generateCorridors())break}if(t)for(let i=0;i<this._width;i++)for(let e=0;e<this._height;e++)t(i,e,this._map[i][e]);return this}_generateRooms(){let t,e=this._width-2,i=this._height-2;do{if(t=this._generateRoom(),this._dug/(e*i)>this._options.roomDugPercentage)break}while(t)}_generateRoom(){let t=0;for(;t<this._roomAttempts;){t++;let i=e.Room.createRandom(this._width,this._height,this._options);if(i.isValid(this._isWallCallback,this._canBeDugCallback))return i.create(this._digCallback),this._rooms.push(i),i}return null}_generateCorridors(){let t=0;for(;t<this._corridorAttempts;){t++,this._corridors=[],this._map=this._fillMap(1);for(let t=0;t<this._rooms.length;t++){let e=this._rooms[t];e.clearDoors(),e.create(this._digCallback)}for(this._unconnected=i.default.shuffle(this._rooms.slice()),this._connected=[],this._unconnected.length&&this._connected.push(this._unconnected.pop());;){let t=i.default.getItem(this._connected);if(!t)break;let e=this._closestRoom(this._unconnected,t);if(!e)break;let s=this._closestRoom(this._connected,e);if(!s)break;if(!this._connectRooms(e,s))break;if(!this._unconnected.length)return!0}}return!1}_closestRoom(t,e){let i=1/0,s=e.getCenter(),o=null;for(let h=0;h<t.length;h++){let e=t[h],n=e.getCenter(),r=n[0]-s[0],l=n[1]-s[1],a=r*r+l*l;a<i&&(i=a,o=e)}return o}_connectRooms(t,e){let i,s,o,h,n,r,l,a=t.getCenter(),c=e.getCenter(),_=c[0]-a[0],g=c[1]-a[1];if(Math.abs(_)<Math.abs(g)?(h=((o=g>0?2:0)+2)%4,n=e.getLeft(),r=e.getRight(),l=0):(h=((o=_>0?1:3)+2)%4,n=e.getTop(),r=e.getBottom(),l=1),!(i=this._placeInWall(t,o)))return!1;if(i[l]>=n&&i[l]<=r){s=i.slice();let t=0;switch(h){case 0:t=e.getTop()-1;break;case 1:t=e.getRight()+1;break;case 2:t=e.getBottom()+1;break;case 3:t=e.getLeft()-1}s[(l+1)%2]=t,this._digLine([i,s])}else if(i[l]<n-1||i[l]>r+1){let t=i[l]-c[l],o=0;switch(h){case 0:case 1:o=t<0?3:1;break;case 2:case 3:o=t<0?1:3}if(h=(h+o)%4,!(s=this._placeInWall(e,h)))return!1;let n=[0,0];n[l]=i[l];let r=(l+1)%2;n[r]=s[r],this._digLine([i,n,s])}else{let t=(l+1)%2;if(!(s=this._placeInWall(e,h)))return!1;let o=Math.round((s[t]+i[t])/2),n=[0,0],r=[0,0];n[l]=i[l],n[t]=o,r[l]=s[l],r[t]=o,this._digLine([i,n,r,s])}return t.addDoor(i[0],i[1]),e.addDoor(s[0],s[1]),-1!=(l=this._unconnected.indexOf(t))&&(this._unconnected.splice(l,1),this._connected.push(t)),-1!=(l=this._unconnected.indexOf(e))&&(this._unconnected.splice(l,1),this._connected.push(e)),!0}_placeInWall(t,e){let s=[0,0],o=[0,0],h=0;switch(e){case 0:o=[1,0],s=[t.getLeft(),t.getTop()-1],h=t.getRight()-t.getLeft()+1;break;case 1:o=[0,1],s=[t.getRight()+1,t.getTop()],h=t.getBottom()-t.getTop()+1;break;case 2:o=[1,0],s=[t.getLeft(),t.getBottom()+1],h=t.getRight()-t.getLeft()+1;break;case 3:o=[0,1],s=[t.getLeft()-1,t.getTop()],h=t.getBottom()-t.getTop()+1}let n=[],r=-2;for(let i=0;i<h;i++){let t=s[0]+i*o[0],e=s[1]+i*o[1];n.push(null),1==this._map[t][e]?r!=i-1&&(n[i]=[t,e]):(r=i,i&&(n[i-1]=null))}for(let i=n.length-1;i>=0;i--)n[i]||n.splice(i,1);return n.length?i.default.getItem(n):null}_digLine(t){for(let i=1;i<t.length;i++){let s=t[i-1],o=t[i],h=new e.Corridor(s[0],s[1],o[0],o[1]);h.create(this._digCallback),this._corridors.push(h)}}_digCallback(t,e,i){this._map[t][e]=i,0==i&&this._dug++}_isWallCallback(t,e){return!(t<0||e<0||t>=this._width||e>=this._height)&&1==this._map[t][e]}_canBeDugCallback(t,e){return!(t<1||e<1||t+1>=this._width||e+1>=this._height)&&1==this._map[t][e]}}exports.default=o;
},{"./dungeon.js":"aBaJ","./features.js":"ynS2","../rng.js":"JPYe"}],"ZnOq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("./map.js")),e=require("../constants.js"),i=s(require("../rng.js"));function s(t){return t&&t.__esModule?t:{default:t}}class o extends t.default{constructor(t,i,s={}){super(t,i),this._options={born:[5,6,7,8],survive:[4,5,6,7,8],topology:8},this.setOptions(s),this._dirs=e.DIRS[this._options.topology],this._map=this._fillMap(0)}randomize(t){for(let e=0;e<this._width;e++)for(let s=0;s<this._height;s++)this._map[e][s]=i.default.getUniform()<t?1:0;return this}setOptions(t){Object.assign(this._options,t)}set(t,e,i){this._map[t][e]=i}create(t){let e=this._fillMap(0),i=this._options.born,s=this._options.survive;for(let o=0;o<this._height;o++){let t=1,l=0;6==this._options.topology&&(t=2,l=o%2);for(let h=l;h<this._width;h+=t){let t=this._map[h][o],l=this._getNeighbors(h,o);t&&-1!=s.indexOf(l)?e[h][o]=1:t||-1==i.indexOf(l)||(e[h][o]=1)}}this._map=e,t&&this._serviceCallback(t)}_serviceCallback(t){for(let e=0;e<this._height;e++){let i=1,s=0;6==this._options.topology&&(i=2,s=e%2);for(let o=s;o<this._width;o+=i)t(o,e,this._map[o][e])}}_getNeighbors(t,e){let i=0;for(let s=0;s<this._dirs.length;s++){let o=this._dirs[s],l=t+o[0],h=e+o[1];l<0||l>=this._width||h<0||h>=this._height||(i+=1==this._map[l][h]?1:0)}return i}connect(t,e,s){e||(e=0);let o=[],l={},h=1,n=[0,0];6==this._options.topology&&(h=2,n=[0,1]);for(let i=0;i<this._height;i++)for(let t=n[i%2];t<this._width;t+=h)if(this._freeSpace(t,i,e)){let e=[t,i];l[this._pointKey(e)]=e,o.push([t,i])}let r=o[i.default.getUniformInt(0,o.length-1)],_=this._pointKey(r),p={};for(p[_]=r,delete l[_],this._findConnected(p,l,[r],!1,e);Object.keys(l).length>0;){let t=this._getFromTo(p,l),i=t[0],o=t[1],h={};h[this._pointKey(i)]=i,this._findConnected(h,l,[i],!0,e),(6==this._options.topology?this._tunnelToConnected6:this._tunnelToConnected).call(this,o,i,p,l,e,s);for(let s in h){let t=h[s];this._map[t[0]][t[1]]=e,p[s]=t,delete l[s]}}t&&this._serviceCallback(t)}_getFromTo(t,e){let s,o=[0,0],l=[0,0],h=Object.keys(t),n=Object.keys(e);for(let r=0;r<5;r++){if(h.length<n.length){let s=h;l=t[s[i.default.getUniformInt(0,s.length-1)]],o=this._getClosest(l,e)}else{let s=n;o=e[s[i.default.getUniformInt(0,s.length-1)]],l=this._getClosest(o,t)}if((s=(o[0]-l[0])*(o[0]-l[0])+(o[1]-l[1])*(o[1]-l[1]))<64)break}return[o,l]}_getClosest(t,e){let i=null,s=null;for(let o in e){let l=e[o],h=(l[0]-t[0])*(l[0]-t[0])+(l[1]-t[1])*(l[1]-t[1]);(null==s||h<s)&&(s=h,i=l)}return i}_findConnected(t,e,i,s,o){for(;i.length>0;){let l,h=i.splice(0,1)[0];l=6==this._options.topology?[[h[0]+2,h[1]],[h[0]+1,h[1]-1],[h[0]-1,h[1]-1],[h[0]-2,h[1]],[h[0]-1,h[1]+1],[h[0]+1,h[1]+1]]:[[h[0]+1,h[1]],[h[0]-1,h[1]],[h[0],h[1]+1],[h[0],h[1]-1]];for(let n=0;n<l.length;n++){let h=this._pointKey(l[n]);null==t[h]&&this._freeSpace(l[n][0],l[n][1],o)&&(t[h]=l[n],s||delete e[h],i.push(l[n]))}}}_tunnelToConnected(t,e,i,s,o,l){let h,n;e[0]<t[0]?(h=e,n=t):(h=t,n=e);for(let _=h[0];_<=n[0];_++){this._map[_][h[1]]=o;let t=[_,h[1]],e=this._pointKey(t);i[e]=t,delete s[e]}l&&h[0]<n[0]&&l(h,[n[0],h[1]]);let r=n[0];e[1]<t[1]?(h=e,n=t):(h=t,n=e);for(let _=h[1];_<n[1];_++){this._map[r][_]=o;let t=[r,_],e=this._pointKey(t);i[e]=t,delete s[e]}l&&h[1]<n[1]&&l([n[0],h[1]],[n[0],n[1]])}_tunnelToConnected6(t,e,i,s,o,l){let h,n;e[0]<t[0]?(h=e,n=t):(h=t,n=e);let r=h[0],_=h[1];for(;r!=n[0]||_!=n[1];){let t=2;_<n[1]?(_++,t=1):_>n[1]&&(_--,t=1),r<n[0]?r+=t:r>n[0]?r-=t:n[1]%2?r-=t:r+=t,this._map[r][_]=o;let e=[r,_],l=this._pointKey(e);i[l]=e,delete s[l]}l&&l(e,t)}_freeSpace(t,e,i){return t>=0&&t<this._width&&e>=0&&e<this._height&&this._map[t][e]==i}_pointKey(t){return t[0]+"."+t[1]}}exports.default=o;
},{"./map.js":"a9E1","../constants.js":"XzVr","../rng.js":"JPYe"}],"MAqV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=l(require("./dungeon.js")),i=require("./features.js"),e=l(require("../rng.js")),s=require("../constants.js");function l(t){return t&&t.__esModule?t:{default:t}}const r={room:i.Room,corridor:i.Corridor};class a extends t.default{constructor(t,i,e={}){super(t,i),this._options=Object.assign({roomWidth:[3,9],roomHeight:[3,5],corridorLength:[3,10],dugPercentage:.2,timeLimit:1e3},e),this._features={room:4,corridor:4},this._map=[],this._featureAttempts=20,this._walls={},this._dug=0,this._digCallback=this._digCallback.bind(this),this._canBeDugCallback=this._canBeDugCallback.bind(this),this._isWallCallback=this._isWallCallback.bind(this),this._priorityWallCallback=this._priorityWallCallback.bind(this)}create(t){this._rooms=[],this._corridors=[],this._map=this._fillMap(1),this._walls={},this._dug=0;let i=(this._width-2)*(this._height-2);this._firstRoom();let e,s=Date.now();do{if(e=0,Date.now()-s>this._options.timeLimit)break;let t=this._findWall();if(!t)break;let i=t.split(","),l=parseInt(i[0]),r=parseInt(i[1]),a=this._getDiggingDirection(l,r);if(!a)continue;let h=0;do{if(h++,this._tryFeature(l,r,a[0],a[1])){this._removeSurroundingWalls(l,r),this._removeSurroundingWalls(l-a[0],r-a[1]);break}}while(h<this._featureAttempts);for(let s in this._walls)this._walls[s]>1&&e++}while(this._dug/i<this._options.dugPercentage||e);if(this._addDoors(),t)for(let l=0;l<this._width;l++)for(let i=0;i<this._height;i++)t(l,i,this._map[l][i]);return this._walls={},this._map=[],this}_digCallback(t,i,e){0==e||2==e?(this._map[t][i]=0,this._dug++):this._walls[t+","+i]=1}_isWallCallback(t,i){return!(t<0||i<0||t>=this._width||i>=this._height)&&1==this._map[t][i]}_canBeDugCallback(t,i){return!(t<1||i<1||t+1>=this._width||i+1>=this._height)&&1==this._map[t][i]}_priorityWallCallback(t,i){this._walls[t+","+i]=2}_firstRoom(){let t=Math.floor(this._width/2),e=Math.floor(this._height/2),s=i.Room.createRandomCenter(t,e,this._options);this._rooms.push(s),s.create(this._digCallback)}_findWall(){let t=[],i=[];for(let e in this._walls){2==this._walls[e]?i.push(e):t.push(e)}let s=i.length?i:t;if(!s.length)return null;let l=e.default.getItem(s.sort());return delete this._walls[l],l}_tryFeature(t,s,l,a){let h=e.default.getWeightedValue(this._features),o=r[h].createRandomAt(t,s,l,a,this._options);return!!o.isValid(this._isWallCallback,this._canBeDugCallback)&&(o.create(this._digCallback),o instanceof i.Room&&this._rooms.push(o),o instanceof i.Corridor&&(o.createPriorityWalls(this._priorityWallCallback),this._corridors.push(o)),!0)}_removeSurroundingWalls(t,i){let e=s.DIRS[4];for(let s=0;s<e.length;s++){let l=e[s],r=t+l[0],a=i+l[1];delete this._walls[r+","+a],r=t+2*l[0],a=i+2*l[1],delete this._walls[r+","+a]}}_getDiggingDirection(t,i){if(t<=0||i<=0||t>=this._width-1||i>=this._height-1)return null;let e=null,l=s.DIRS[4];for(let s=0;s<l.length;s++){let r=l[s],a=t+r[0],h=i+r[1];if(!this._map[a][h]){if(e)return null;e=r}}return e?[-e[0],-e[1]]:null}_addDoors(){let t=this._map;function i(i,e){return 1==t[i][e]}for(let e=0;e<this._rooms.length;e++){let t=this._rooms[e];t.clearDoors(),t.addDoors(i)}}}exports.default=a;
},{"./dungeon.js":"aBaJ","./features.js":"ynS2","../rng.js":"JPYe","../constants.js":"XzVr"}],"eSSl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./map.js")),t=r(require("../rng.js"));function r(e){return e&&e.__esModule?e:{default:e}}function i(e,t,r){r[t[e+1]]=r[e],t[r[e]]=t[e+1],r[e]=e+1,t[e+1]=e}function l(e,t,r){r[t[e]]=r[e],t[r[e]]=t[e],r[e]=e,t[e]=e}class f extends e.default{create(e){let r,f=this._fillMap(1),s=Math.ceil((this._width-2)/2),u=[],o=[];for(let t=0;t<s;t++)u.push(t),o.push(t);for(u.push(s-1),r=1;r+3<this._height;r+=2)for(let e=0;e<s;e++){let s=2*e+1,h=r;f[s][h]=0,e!=u[e+1]&&t.default.getUniform()>.375&&(i(e,u,o),f[s+1][h]=0),e!=u[e]&&t.default.getUniform()>.375?l(e,u,o):f[s][h+1]=0}for(let h=0;h<s;h++){let e=2*h+1,s=r;f[e][s]=0,h!=u[h+1]&&(h==u[h]||t.default.getUniform()>.375)&&(i(h,u,o),f[e+1][s]=0),l(h,u,o)}for(let t=0;t<this._width;t++)for(let r=0;r<this._height;r++)e(t,r,f[t][r]);return this}}exports.default=f;
},{"./map.js":"a9E1","../rng.js":"JPYe"}],"cjzB":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./map.js")),s=e(require("../rng.js"));function e(t){return t&&t.__esModule?t:{default:t}}class h extends t.default{constructor(){super(...arguments),this._stack=[],this._map=[]}create(t){let s=this._width,e=this._height;this._map=[];for(let h=0;h<s;h++){this._map.push([]);for(let t=0;t<e;t++){let i=0==h||0==t||h+1==s||t+1==e;this._map[h].push(i?1:0)}}this._stack=[[1,1,s-2,e-2]],this._process();for(let h=0;h<s;h++)for(let s=0;s<e;s++)t(h,s,this._map[h][s]);return this._map=[],this}_process(){for(;this._stack.length;){let t=this._stack.shift();this._partitionRoom(t)}}_partitionRoom(t){let e=[],h=[];for(let s=t[0]+1;s<t[2];s++){let h=this._map[s][t[1]-1],i=this._map[s][t[3]+1];!h||!i||s%2||e.push(s)}for(let s=t[1]+1;s<t[3];s++){let e=this._map[t[0]-1][s],i=this._map[t[2]+1][s];!e||!i||s%2||h.push(s)}if(!e.length||!h.length)return;let i=s.default.getItem(e),p=s.default.getItem(h);this._map[i][p]=1;let a=[],l=[];a.push(l);for(let s=t[0];s<i;s++)this._map[s][p]=1,s%2&&l.push([s,p]);l=[],a.push(l);for(let s=i+1;s<=t[2];s++)this._map[s][p]=1,s%2&&l.push([s,p]);l=[],a.push(l);for(let s=t[1];s<p;s++)this._map[i][s]=1,s%2&&l.push([i,s]);l=[],a.push(l);for(let s=p+1;s<=t[3];s++)this._map[i][s]=1,s%2&&l.push([i,s]);let r=s.default.getItem(a);for(let u=0;u<a.length;u++){let t=a[u];if(t==r)continue;let e=s.default.getItem(t);this._map[e[0]][e[1]]=0}this._stack.push([t[0],t[1],i-1,p-1]),this._stack.push([i+1,t[1],t[2],p-1]),this._stack.push([t[0],p+1,i-1,t[3]]),this._stack.push([i+1,p+1,t[2],t[3]])}}exports.default=h;
},{"./map.js":"a9E1","../rng.js":"JPYe"}],"ccWJ":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./map.js")),t=r(require("../rng.js"));function r(e){return e&&e.__esModule?e:{default:e}}class i extends e.default{constructor(e,t,r=0){super(e,t),this._regularity=r,this._map=[]}create(e){let r=this._width,i=this._height,s=this._fillMap(1);r-=r%2?1:2,i-=i%2?1:2;let a=0,o=0,l=0,h=0,f=0,u=!1,d=[[0,0],[0,0],[0,0],[0,0]];do{if(a=1+2*Math.floor(t.default.getUniform()*(r-1)/2),o=1+2*Math.floor(t.default.getUniform()*(i-1)/2),f||(s[a][o]=0),!s[a][o]){this._randomize(d);do{0==Math.floor(t.default.getUniform()*(this._regularity+1))&&this._randomize(d),u=!0;for(let e=0;e<4;e++)if(l=a+2*d[e][0],h=o+2*d[e][1],this._isFree(s,l,h,r,i)){s[l][h]=0,s[a+d[e][0]][o+d[e][1]]=0,a=l,o=h,u=!1,f++;break}}while(!u)}}while(f+1<r*i/4);for(let t=0;t<this._width;t++)for(let r=0;r<this._height;r++)e(t,r,s[t][r]);return this._map=[],this}_randomize(e){for(let t=0;t<4;t++)e[t][0]=0,e[t][1]=0;switch(Math.floor(4*t.default.getUniform())){case 0:e[0][0]=-1,e[1][0]=1,e[2][1]=-1,e[3][1]=1;break;case 1:e[3][0]=-1,e[2][0]=1,e[1][1]=-1,e[0][1]=1;break;case 2:e[2][0]=-1,e[3][0]=1,e[0][1]=-1,e[1][1]=1;break;case 3:e[1][0]=-1,e[0][0]=1,e[3][1]=-1,e[2][1]=1}}_isFree(e,t,r,i,s){return!(t<1||r<1||t>=i||r>=s)&&e[t][r]}}exports.default=i;
},{"./map.js":"a9E1","../rng.js":"JPYe"}],"dNNp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("./map.js")),o=i(require("../rng.js")),e=require("../constants.js");function i(t){return t&&t.__esModule?t:{default:t}}class s extends t.default{constructor(t,o,e){super(t,o),this.map=[],this.rooms=[],this.connectedCells=[],(e=Object.assign({cellWidth:3,cellHeight:3},e)).hasOwnProperty("roomWidth")||(e.roomWidth=this._calculateRoomSize(this._width,e.cellWidth)),e.hasOwnProperty("roomHeight")||(e.roomHeight=this._calculateRoomSize(this._height,e.cellHeight)),this._options=e}create(t){if(this.map=this._fillMap(1),this.rooms=[],this.connectedCells=[],this._initRooms(),this._connectRooms(),this._connectUnconnectedRooms(),this._createRandomRoomConnections(),this._createRooms(),this._createCorridors(),t)for(let o=0;o<this._width;o++)for(let e=0;e<this._height;e++)t(o,e,this.map[o][e]);return this}_calculateRoomSize(t,o){let e=Math.floor(t/o*.8),i=Math.floor(t/o*.25);return i<2&&(i=2),e<2&&(e=2),[i,e]}_initRooms(){for(let t=0;t<this._options.cellWidth;t++){this.rooms.push([]);for(let o=0;o<this._options.cellHeight;o++)this.rooms[t].push({x:0,y:0,width:0,height:0,connections:[],cellx:t,celly:o})}}_connectRooms(){let t,i,s,h,l,n,r=o.default.getUniformInt(0,this._options.cellWidth-1),c=o.default.getUniformInt(0,this._options.cellHeight-1),a=!1;do{n=[0,2,4,6],n=o.default.shuffle(n);do{if(a=!1,t=n.pop(),i=r+e.DIRS[8][t][0],s=c+e.DIRS[8][t][1],!(i<0||i>=this._options.cellWidth||s<0||s>=this._options.cellHeight)){if((h=this.rooms[r][c]).connections.length>0&&h.connections[0][0]==i&&h.connections[0][1]==s)break;0==(l=this.rooms[i][s]).connections.length&&(l.connections.push([r,c]),this.connectedCells.push([i,s]),r=i,c=s,a=!0)}}while(n.length>0&&0==a)}while(n.length>0)}_connectUnconnectedRooms(){let t,i,s,h=this._options.cellWidth,l=this._options.cellHeight;this.connectedCells=o.default.shuffle(this.connectedCells);for(let n=0;n<this._options.cellWidth;n++)for(let r=0;r<this._options.cellHeight;r++)if(0==(t=this.rooms[n][r]).connections.length){let c=[0,2,4,6];c=o.default.shuffle(c),s=!1;do{let t=c.pop(),o=n+e.DIRS[8][t][0],a=r+e.DIRS[8][t][1];if(!(o<0||o>=h||a<0||a>=l)){if(s=!0,0==(i=this.rooms[o][a]).connections.length)break;for(let t=0;t<i.connections.length;t++)if(i.connections[t][0]==n&&i.connections[t][1]==r){s=!1;break}if(s)break}}while(c.length);s?t.connections.push([i.cellx,i.celly]):console.log("-- Unable to connect room.")}}_createRandomRoomConnections(){}_createRooms(){let t,e,i,s,h,l=this._width,n=this._height,r=this._options.cellWidth,c=this._options.cellHeight,a=Math.floor(this._width/r),f=Math.floor(this._height/c),d=this._options.roomWidth,m=this._options.roomHeight;for(let p=0;p<r;p++)for(let r=0;r<c;r++){if(0==(i=a*p)&&(i=1),0==(s=f*r)&&(s=1),t=o.default.getUniformInt(d[0],d[1]),e=o.default.getUniformInt(m[0],m[1]),r>0)for(h=this.rooms[p][r-1];s-(h.y+h.height)<3;)s++;if(p>0)for(h=this.rooms[p-1][r];i-(h.x+h.width)<3;)i++;let c=Math.round(o.default.getUniformInt(0,a-t)/2),_=Math.round(o.default.getUniformInt(0,f-e)/2);for(;i+c+t>=l;)c?c--:t--;for(;s+_+e>=n;)_?_--:e--;i+=c,s+=_,this.rooms[p][r].x=i,this.rooms[p][r].y=s,this.rooms[p][r].width=t,this.rooms[p][r].height=e;for(let o=i;o<i+t;o++)for(let t=s;t<s+e;t++)this.map[o][t]=0}}_getWallPosition(t,e){let i,s,h;return 1==e||3==e?(i=o.default.getUniformInt(t.x+1,t.x+t.width-2),h=1==e?(s=t.y-2)+1:(s=t.y+t.height+1)-1,this.map[i][h]=0):(s=o.default.getUniformInt(t.y+1,t.y+t.height-2),h=2==e?(i=t.x+t.width+1)-1:(i=t.x-2)+1,this.map[h][s]=0),[i,s]}_drawCorridor(t,i){let s,h,l,n,r=i[0]-t[0],c=i[1]-t[1],a=t[0],f=t[1],d=[],m=Math.abs(r),p=Math.abs(c),_=o.default.getUniform(),u=_,g=1-_;for(h=r>0?2:6,l=c>0?4:0,m<p?(s=Math.ceil(p*u),d.push([l,s]),d.push([h,m]),s=Math.floor(p*g),d.push([l,s])):(s=Math.ceil(m*u),d.push([h,s]),d.push([l,p]),s=Math.floor(m*g),d.push([h,s])),this.map[a][f]=0;d.length>0;)for(n=d.pop();n[1]>0;)a+=e.DIRS[8][n[0]][0],f+=e.DIRS[8][n[0]][1],this.map[a][f]=0,n[1]=n[1]-1}_createCorridors(){let t,o,e,i,s,h=this._options.cellWidth,l=this._options.cellHeight;for(let n=0;n<h;n++)for(let h=0;h<l;h++){t=this.rooms[n][h];for(let h=0;h<t.connections.length;h++)o=t.connections[h],(e=this.rooms[o[0]][o[1]]).cellx>t.cellx?(i=2,s=4):e.cellx<t.cellx?(i=4,s=2):e.celly>t.celly?(i=3,s=1):(i=1,s=3),this._drawCorridor(this._getWallPosition(t,i),this._getWallPosition(e,s))}}}exports.default=s;
},{"./map.js":"a9E1","../rng.js":"JPYe","../constants.js":"XzVr"}],"w6L5":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=f(require("./arena.js")),r=f(require("./uniform.js")),u=f(require("./cellular.js")),a=f(require("./digger.js")),l=f(require("./ellermaze.js")),d=f(require("./dividedmaze.js")),i=f(require("./iceymaze.js")),t=f(require("./rogue.js"));function f(e){return e&&e.__esModule?e:{default:e}}var s={Arena:e.default,Uniform:r.default,Cellular:u.default,Digger:a.default,EllerMaze:l.default,DividedMaze:d.default,IceyMaze:i.default,Rogue:t.default};exports.default=s;
},{"./arena.js":"qL5h","./uniform.js":"mUAp","./cellular.js":"ZnOq","./digger.js":"MAqV","./ellermaze.js":"eSSl","./dividedmaze.js":"cjzB","./iceymaze.js":"ccWJ","./rogue.js":"dNNp"}],"y98h":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class e{}exports.default=e;
},{}],"etqn":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=r(require("./noise.js")),t=r(require("../rng.js")),s=require("../util.js");function r(e){return e&&e.__esModule?e:{default:e}}const i=.5*(Math.sqrt(3)-1),l=(3-Math.sqrt(3))/6;class h extends e.default{constructor(e=256){super(),this._gradients=[[0,-1],[1,-1],[1,0],[1,1],[0,1],[-1,1],[-1,0],[-1,-1]];let s=[];for(let t=0;t<e;t++)s.push(t);s=t.default.shuffle(s),this._perms=[],this._indexes=[];for(let t=0;t<2*e;t++)this._perms.push(s[t%e]),this._indexes.push(this._perms[t]%this._gradients.length)}get(e,t){let r,h,u,d=this._perms,n=this._indexes,o=d.length/2,a=0,f=0,_=0,p=(e+t)*i,g=Math.floor(e+p),c=Math.floor(t+p),x=(g+c)*l,m=e-(g-x),M=t-(c-x);m>M?(h=1,u=0):(h=0,u=1);let q=m-h+l,j=M-u+l,v=m-1+2*l,b=M-1+2*l,y=(0,s.mod)(g,o),O=(0,s.mod)(c,o),P=.5-m*m-M*M;if(P>=0){P*=P,r=n[y+d[O]];let e=this._gradients[r];a=P*P*(e[0]*m+e[1]*M)}let k=.5-q*q-j*j;if(k>=0){k*=k,r=n[y+h+d[O+u]];let e=this._gradients[r];f=k*k*(e[0]*q+e[1]*j)}let w=.5-v*v-b*b;if(w>=0){w*=w,r=n[y+1+d[O+1]];let e=this._gradients[r];_=w*w*(e[0]*v+e[1]*b)}return 70*(a+f+_)}}exports.default=h;
},{"./noise.js":"y98h","../rng.js":"JPYe","../util.js":"gHLf"}],"NNPp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./simplex.js"));function t(e){return e&&e.__esModule?e:{default:e}}var r={Simplex:e.default};exports.default=r;
},{"./simplex.js":"etqn"}],"pmJe":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var s=require("../constants.js");class t{constructor(t,i,o,r={}){this._toX=t,this._toY=i,this._passableCallback=o,this._options=Object.assign({topology:8},r),this._dirs=s.DIRS[this._options.topology],8==this._options.topology&&(this._dirs=[this._dirs[0],this._dirs[2],this._dirs[4],this._dirs[6],this._dirs[1],this._dirs[3],this._dirs[5],this._dirs[7]])}_getNeighbors(s,t){let i=[];for(let o=0;o<this._dirs.length;o++){let r=this._dirs[o],e=s+r[0],h=t+r[1];this._passableCallback(e,h)&&i.push([e,h])}return i}}exports.default=t;
},{"../constants.js":"XzVr"}],"aUGH":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=e(require("./path.js"));function e(t){return t&&t.__esModule?t:{default:t}}class o extends t.default{constructor(t,e,o,s){super(t,e,o,s),this._computed={},this._todo=[],this._add(t,e,null)}compute(t,e,o){let s=t+","+e;if(s in this._computed||this._compute(t,e),!(s in this._computed))return;let i=this._computed[s];for(;i;)o(i.x,i.y),i=i.prev}_compute(t,e){for(;this._todo.length;){let o=this._todo.shift();if(o.x==t&&o.y==e)return;let s=this._getNeighbors(o.x,o.y);for(let t=0;t<s.length;t++){let e=s[t],i=e[0],u=e[1];i+","+u in this._computed||this._add(i,u,o)}}}_add(t,e,o){let s={x:t,y:e,prev:o};this._computed[t+","+e]=s,this._todo.push(s)}}exports.default=o;
},{"./path.js":"pmJe"}],"WrMp":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=s(require("./path.js"));function s(t){return t&&t.__esModule?t:{default:t}}class e extends t.default{constructor(t,s,e,o={}){super(t,s,e,o),this._todo=[],this._done={}}compute(t,s,e){for(this._todo=[],this._done={},this._fromX=t,this._fromY=s,this._add(this._toX,this._toY,null);this._todo.length;){let e=this._todo.shift(),o=e.x+","+e.y;if(o in this._done)continue;if(this._done[o]=e,e.x==t&&e.y==s)break;let h=this._getNeighbors(e.x,e.y);for(let t=0;t<h.length;t++){let s=h[t],o=s[0],i=s[1];o+","+i in this._done||this._add(o,i,e)}}let o=this._done[t+","+s];if(o)for(;o;)e(o.x,o.y),o=o.prev}_add(t,s,e){let o=this._distance(t,s),h={x:t,y:s,prev:e,g:e?e.g+1:0,h:o},i=h.g+h.h;for(let r=0;r<this._todo.length;r++){let t=this._todo[r],s=t.g+t.h;if(i<s||i==s&&o<t.h)return void this._todo.splice(r,0,h)}this._todo.push(h)}_distance(t,s){switch(this._options.topology){case 4:return Math.abs(t-this._fromX)+Math.abs(s-this._fromY);case 6:let e=Math.abs(t-this._fromX),o=Math.abs(s-this._fromY);return o+Math.max(0,(e-o)/2);case 8:return Math.max(Math.abs(t-this._fromX),Math.abs(s-this._fromY))}}}exports.default=e;
},{"./path.js":"pmJe"}],"oufk":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./dijkstra.js")),r=t(require("./astar.js"));function t(e){return e&&e.__esModule?e:{default:e}}var a={Dijkstra:e.default,AStar:r.default};exports.default=a;
},{"./dijkstra.js":"aUGH","./astar.js":"WrMp"}],"EeXr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;class t{constructor(t){this._scheduler=t,this._lock=1}start(){return this.unlock()}lock(){return this._lock++,this}unlock(){if(!this._lock)throw new Error("Cannot unlock unlocked engine");for(this._lock--;!this._lock;){let t=this._scheduler.next();if(!t)return this.lock();let e=t.act();e&&e.then&&(this.lock(),e.then(this.unlock.bind(this)))}return this}}exports.default=t;
},{}],"gTNX":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var t=i(require("./color.js"));function e(t){if("function"!=typeof WeakMap)return null;var i=new WeakMap,s=new WeakMap;return(e=function(t){return t?s:i})(t)}function i(t,i){if(!i&&t&&t.__esModule)return t;if(null===t||"object"!=typeof t&&"function"!=typeof t)return{default:t};var s=e(i);if(s&&s.has(t))return s.get(t);var r={},n=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if("default"!==o&&Object.prototype.hasOwnProperty.call(t,o)){var h=n?Object.getOwnPropertyDescriptor(t,o):null;h&&(h.get||h.set)?Object.defineProperty(r,o,h):r[o]=t[o]}return r.default=t,s&&s.set(t,r),r}class s{constructor(t,e={}){this._reflectivityCallback=t,this._options={},e=Object.assign({passes:1,emissionThreshold:100,range:10},e),this._lights={},this._reflectivityCache={},this._fovCache={},this.setOptions(e)}setOptions(t){return Object.assign(this._options,t),t&&t.range&&this.reset(),this}setFOV(t){return this._fov=t,this._fovCache={},this}setLight(e,i,s){let r=e+","+i;return s?this._lights[r]="string"==typeof s?t.fromString(s):s:delete this._lights[r],this}clearLights(){this._lights={}}reset(){return this._reflectivityCache={},this._fovCache={},this}compute(e){let i={},s={},r={};for(let n in this._lights){let e=this._lights[n];s[n]=[0,0,0],t.add_(s[n],e)}for(let t=0;t<this._options.passes;t++)this._emitLight(s,r,i),t+1!=this._options.passes&&(s=this._computeEmitters(r,i));for(let t in r){let i=t.split(",");e(parseInt(i[0]),parseInt(i[1]),r[t])}return this}_emitLight(t,e,i){for(let s in t){let r=s.split(","),n=parseInt(r[0]),o=parseInt(r[1]);this._emitLightFromCell(n,o,t[s],e),i[s]=1}return this}_computeEmitters(t,e){let i={};for(let s in t){if(s in e)continue;let r,n=t[s];if(s in this._reflectivityCache)r=this._reflectivityCache[s];else{let t=s.split(","),e=parseInt(t[0]),i=parseInt(t[1]);r=this._reflectivityCallback(e,i),this._reflectivityCache[s]=r}if(0==r)continue;let o=[0,0,0],h=0;for(let t=0;t<3;t++){let e=Math.round(n[t]*r);o[t]=e,h+=e}h>this._options.emissionThreshold&&(i[s]=o)}return i}_emitLightFromCell(t,e,i,s){let r,n=t+","+e;r=n in this._fovCache?this._fovCache[n]:this._updateFOV(t,e);for(let o in r){let t,e=r[o];o in s?t=s[o]:(t=[0,0,0],s[o]=t);for(let s=0;s<3;s++)t[s]+=Math.round(i[s]*e)}return this}_updateFOV(t,e){let i=t+","+e,s={};this._fovCache[i]=s;let r=this._options.range;return this._fov.compute(t,e,r,function(t,e,i,n){let o=n*(1-i/r);0!=o&&(s[t+","+e]=o)}.bind(this)),s}}exports.default=s;
},{"./color.js":"ZPt1"}],"KQ1H":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),Object.defineProperty(exports,"RNG",{enumerable:!0,get:function(){return e.default}}),Object.defineProperty(exports,"Display",{enumerable:!0,get:function(){return r.default}}),Object.defineProperty(exports,"StringGenerator",{enumerable:!0,get:function(){return t.default}}),Object.defineProperty(exports,"EventQueue",{enumerable:!0,get:function(){return n.default}}),Object.defineProperty(exports,"Scheduler",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(exports,"FOV",{enumerable:!0,get:function(){return o.default}}),Object.defineProperty(exports,"Map",{enumerable:!0,get:function(){return i.default}}),Object.defineProperty(exports,"Noise",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(exports,"Path",{enumerable:!0,get:function(){return s.default}}),Object.defineProperty(exports,"Engine",{enumerable:!0,get:function(){return p.default}}),Object.defineProperty(exports,"Lighting",{enumerable:!0,get:function(){return a.default}}),Object.defineProperty(exports,"DEFAULT_WIDTH",{enumerable:!0,get:function(){return c.DEFAULT_WIDTH}}),Object.defineProperty(exports,"DEFAULT_HEIGHT",{enumerable:!0,get:function(){return c.DEFAULT_HEIGHT}}),Object.defineProperty(exports,"DIRS",{enumerable:!0,get:function(){return c.DIRS}}),Object.defineProperty(exports,"KEYS",{enumerable:!0,get:function(){return c.KEYS}}),exports.Text=exports.Color=exports.Util=void 0;var e=g(require("./rng.js")),r=g(require("./display/display.js")),t=g(require("./stringgenerator.js")),n=g(require("./eventqueue.js")),u=g(require("./scheduler/index.js")),o=g(require("./fov/index.js")),i=g(require("./map/index.js")),f=g(require("./noise/index.js")),s=g(require("./path/index.js")),p=g(require("./engine.js")),a=g(require("./lighting.js")),c=require("./constants.js"),l=x(require("./util.js")),d=x(require("./color.js")),b=x(require("./text.js"));function j(e){if("function"!=typeof WeakMap)return null;var r=new WeakMap,t=new WeakMap;return(j=function(e){return e?t:r})(e)}function x(e,r){if(!r&&e&&e.__esModule)return e;if(null===e||"object"!=typeof e&&"function"!=typeof e)return{default:e};var t=j(r);if(t&&t.has(e))return t.get(e);var n={},u=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if("default"!==o&&Object.prototype.hasOwnProperty.call(e,o)){var i=u?Object.getOwnPropertyDescriptor(e,o):null;i&&(i.get||i.set)?Object.defineProperty(n,o,i):n[o]=e[o]}return n.default=e,t&&t.set(e,n),n}function g(e){return e&&e.__esModule?e:{default:e}}const y=l;exports.Util=y;const O=d;exports.Color=O;const P=b;exports.Text=P;
},{"./rng.js":"JPYe","./display/display.js":"A2Km","./stringgenerator.js":"sRzJ","./eventqueue.js":"JnHK","./scheduler/index.js":"kH2E","./fov/index.js":"jqIP","./map/index.js":"w6L5","./noise/index.js":"NNPp","./path/index.js":"oufk","./engine.js":"EeXr","./lighting.js":"gTNX","./constants.js":"XzVr","./util.js":"gHLf","./color.js":"ZPt1","./text.js":"nEBA"}],"QcRT":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.Game=void 0;var e=require("rot-js/lib/index");function i(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function t(e,i,t){return i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e}var n=function n(){i(this,n),t(this,"display",null),this.display=new e.Display({width:80,height:25,fontSize:20}),document.body.appendChild(this.display.getContainer())};exports.Game=n;
},{"rot-js/lib/index":"KQ1H"}],"Focm":[function(require,module,exports) {
"use strict";var e=require("./game");document.body.onload=function(){new e.Game};
},{"./game":"QcRT"}]},{},["Focm"], null)
//# sourceMappingURL=/src.6e0754c6.js.map